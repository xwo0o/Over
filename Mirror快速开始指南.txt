## Mirrorä¸»æœº-å®¢æˆ·ç«¯è¿æ¥ - å¿«é€Ÿå¼€å§‹

### ğŸ“‹ å·²å®Œæˆçš„å·¥ä½œ

æœ¬æ¬¡å¼€å‘å®Œæˆäº†ä»¥ä¸‹Mirrorç½‘ç»œåŠŸèƒ½ï¼š

#### 1ï¸âƒ£ å¢å¼ºçš„CustomNetworkManager
- âœ… `SaveCharacterSelection()` - ä¿å­˜è§’è‰²é€‰æ‹©
- âœ… `LoadGameScene()` - åŠ è½½æ¸¸æˆåœºæ™¯
- âœ… `LoadCharacterSelectionScene()` - åŠ è½½è§’è‰²é€‰æ‹©åœºæ™¯  
- âœ… `GetRandomSpawnPosition()` - è·å–éšæœºå‡ºç”Ÿç‚¹
- âœ… `GetPlayerCount()` - è·å–ç©å®¶æ•°é‡
- âœ… `GetPendingCharacterSelection()` - è·å–å¾…é€‰è§’è‰²
- âœ… `GetPlayerCharacterSelections()` - è·å–æ‰€æœ‰ç©å®¶é€‰æ‹©
- âœ… `IsGameStarted()` - æ£€æŸ¥æ¸¸æˆçŠ¶æ€
- âœ… å®Œæ•´çš„ç½‘ç»œäº‹ä»¶å¤„ç†ï¼ˆOnClientConnectã€OnClientDisconnectç­‰ï¼‰

#### 2ï¸âƒ£ æ–°å¢NetworkConnectionUIè„šæœ¬
- âœ… å¯åŠ¨æœåŠ¡å™¨æŒ‰é’®
- âœ… å¯åŠ¨å®¢æˆ·ç«¯æŒ‰é’®  
- âœ… å¯åŠ¨ä¸»æœºæŒ‰é’®
- âœ… åœæ­¢ç½‘ç»œæŒ‰é’®
- âœ… æœåŠ¡å™¨åœ°å€è¾“å…¥æ¡†
- âœ… å®æ—¶è¿æ¥çŠ¶æ€æ˜¾ç¤º
- âœ… ç©å®¶æ•°é‡æ˜¾ç¤º

#### 3ï¸âƒ£ æ–°å¢NetworkConnectionHandlerè„šæœ¬
- âœ… ç›‘å¬Mirrorç½‘ç»œäº‹ä»¶
- âœ… å¤„ç†æœåŠ¡å™¨å¯åŠ¨/åœæ­¢
- âœ… å¤„ç†å®¢æˆ·ç«¯è¿æ¥/æ–­å¼€
- âœ… è‡ªåŠ¨æ›´æ–°UIçŠ¶æ€

#### 4ï¸âƒ£ æ–°å¢NetworkDebugHUDè„šæœ¬
- âœ… å®æ—¶æ˜¾ç¤ºç½‘ç»œæ¨¡å¼ï¼ˆä¸»æœº/æœåŠ¡å™¨/å®¢æˆ·ç«¯/ç¦»çº¿ï¼‰
- âœ… æ˜¾ç¤ºè¿æ¥çŠ¶æ€
- âœ… æ˜¾ç¤ºç©å®¶åˆ—è¡¨
- âœ… æ˜¾ç¤ºè§’è‰²é€‰æ‹©ä¿¡æ¯
- âœ… æ˜¾ç¤ºç½‘ç»œç»Ÿè®¡æ•°æ®

#### 5ï¸âƒ£ å¢å¼ºçš„CharacterSelectController
- âœ… è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… ä¸»æœº/æœåŠ¡å™¨/å®¢æˆ·ç«¯æ¨¡å¼åˆ¤æ–­
- âœ… ç½‘ç»œæ¶ˆæ¯å‘é€ç¡®è®¤
- âœ… åœºæ™¯åŠ è½½å»¶è¿Ÿå¤„ç†

#### 6ï¸âƒ£ æ–°å¢NetworkIntegrationTesterè„šæœ¬
- âœ… æ‰‹åŠ¨æµ‹è¯•æŒ‰é’®ï¼ˆå¯åŠ¨ä¸»æœº/æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼‰
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
- âœ… é€æ­¥è°ƒè¯•æ”¯æŒ

---

### ğŸš€ åœºæ™¯é…ç½®æ­¥éª¤

#### æ­¥éª¤1ï¼šåœ¨CharacterSelectåœºæ™¯ä¸­é…ç½®

1. **åˆ›å»ºNetworkManagerå¯¹è±¡**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š
   - åˆ›å»ºç©ºGameObjectï¼Œå‘½åä¸º"NetworkManager"
   - æ·»åŠ  `CustomNetworkManager` è„šæœ¬
   - æ·»åŠ  `NetworkManagerSetup` è„šæœ¬
   - è®¾ç½®Player Prefabï¼ˆéœ€è¦æœ‰NetworkIdentityï¼‰

2. **åˆ›å»ºUI Canvaså¹¶æ·»åŠ è¿æ¥UI**ï¼š
   ```
   Canvas (æ–°å»º)
   â”œâ”€â”€ Panel_Connection
   â”‚   â”œâ”€â”€ Button_StartServer
   â”‚   â”œâ”€â”€ Button_StartClient
   â”‚   â”œâ”€â”€ Button_StartHost
   â”‚   â”œâ”€â”€ Button_StopNetwork
   â”‚   â”œâ”€â”€ InputField_ServerAddress
   â”‚   â”œâ”€â”€ Text_ConnectionStatus
   â”‚   â”œâ”€â”€ Text_PlayerCount
   â”‚   â””â”€â”€ Text_NetworkMode
   â””â”€â”€ Panel_Loading
       â””â”€â”€ Text_LoadingText
   ```

3. **æ·»åŠ è„šæœ¬åˆ°Canvas**ï¼š
   - æ·»åŠ  `NetworkConnectionUI` è„šæœ¬
   - åœ¨Inspectorä¸­ç»‘å®šæ‰€æœ‰UIå…ƒç´ 

4. **æ·»åŠ ç½‘ç»œäº‹ä»¶å¤„ç†**ï¼š
   - åˆ›å»ºæ–°GameObjectï¼Œå‘½åä¸º"NetworkEventHandler"
   - æ·»åŠ  `NetworkConnectionHandler` è„šæœ¬

5. **æ·»åŠ è°ƒè¯•HUD**ï¼š
   - åˆ›å»ºæ–°GameObjectï¼Œå‘½åä¸º"DebugHUD"
   - æ·»åŠ  `NetworkDebugHUD` è„šæœ¬

6. **æ·»åŠ é›†æˆæµ‹è¯•å™¨**ï¼ˆå¯é€‰ï¼‰ï¼š
   - åˆ›å»ºæ–°GameObjectï¼Œå‘½åä¸º"Tester"
   - æ·»åŠ  `NetworkIntegrationTester` è„šæœ¬

---

### ğŸ® ä½¿ç”¨æŒ‡å—

#### ä¸»æœºæ¨¡å¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```
1. è¿è¡Œæ¸¸æˆ â†’ çœ‹åˆ°è¿æ¥UI
2. ç‚¹å‡» [å¯åŠ¨ä¸»æœº] â†’ åŒæ—¶å¯åŠ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
3. æŸ¥çœ‹å³ä¸Šè§’HUD â†’ åº”æ˜¾ç¤º"æ¨¡å¼: ä¸»æœº (æœåŠ¡å™¨+å®¢æˆ·ç«¯)"
4. è¿›è¡Œè§’è‰²é€‰æ‹©
5. ç‚¹å‡»ç¡®è®¤ â†’ è‡ªåŠ¨åŠ è½½æ¸¸æˆåœºæ™¯
```

**ä¼˜ç‚¹**ï¼šæ— éœ€ç½‘ç»œé…ç½®ï¼Œæµ‹è¯•å¿«é€Ÿ
**ç¼ºç‚¹**ï¼šåªæ”¯æŒå•æœº

#### æœåŠ¡å™¨/å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆå¤šäººæ¸¸æˆï¼‰

**æœåŠ¡å™¨ç«¯**ï¼š
```
1. è¿è¡Œæ¸¸æˆ â†’ çœ‹åˆ°è¿æ¥UI
2. ç‚¹å‡» [å¯åŠ¨æœåŠ¡å™¨]
3. è®°ä¸‹æœåŠ¡å™¨åœ°å€ï¼ˆlocalhost æˆ– å®é™…IPï¼‰
4. HUDæ˜¾ç¤º "æ¨¡å¼: æœåŠ¡å™¨"
```

**å®¢æˆ·ç«¯ç«¯**ï¼š
```
1. è¿è¡Œæ¸¸æˆ â†’ çœ‹åˆ°è¿æ¥UI
2. è¾“å…¥æœåŠ¡å™¨åœ°å€ï¼ˆå¦‚ 192.168.1.100ï¼‰
3. ç‚¹å‡» [å¯åŠ¨å®¢æˆ·ç«¯]
4. ç­‰å¾…è¿æ¥æˆåŠŸ
5. HUDæ˜¾ç¤º "æ¨¡å¼: å®¢æˆ·ç«¯"
6. è¿›è¡Œè§’è‰²é€‰æ‹©å’Œæ¸¸æˆæ“ä½œ
```

---

### ğŸ” è°ƒè¯•æ–¹æ³•

#### æŸ¥çœ‹ç½‘ç»œæ—¥å¿—

æ‰“å¼€Unity Consoleï¼Œè¿è¡Œä¸»æœºæ¨¡å¼ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

```
========== ç¡®è®¤è§’è‰²é€‰æ‹© ==========
é€‰æ‹©è§’è‰²: Scout
isServer: true, isClient: true

ä¸»æœºæ¨¡å¼ï¼šä¿å­˜è§’è‰²é€‰æ‹©å¹¶å‘é€ç½‘ç»œæ¶ˆæ¯
ä¸»æœºå·²å‘é€è§’è‰²é€‰æ‹©æ¶ˆæ¯

========== è§’è‰²é€‰æ‹©å®Œæˆ ==========

æœåŠ¡å™¨å·²ä¿å­˜è§’è‰²é€‰æ‹©: Scout (è¿æ¥ID: 0)
æ‰€æœ‰ç©å®¶éƒ½å·²å®Œæˆè§’è‰²é€‰æ‹©ï¼Œå‡†å¤‡åŠ è½½æ¸¸æˆåœºæ™¯
```

#### ä½¿ç”¨ç½‘ç»œè°ƒè¯•HUD

åœ¨æ¸¸æˆçª—å£å³ä¸Šè§’ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

```
========== ç½‘ç»œè°ƒè¯•ä¿¡æ¯ ==========

ç½‘ç»œæ¨¡å¼
â— ä¸»æœºæ¨¡å¼ (æœåŠ¡å™¨+å®¢æˆ·ç«¯)

è¿æ¥ä¿¡æ¯
æœåŠ¡å™¨çŠ¶æ€: è¿è¡Œä¸­
æœåŠ¡å™¨åœ°å€: localhost
å½“å‰è¿æ¥æ•°: 1

ç©å®¶åˆ—è¡¨
  â— ç©å®¶ (ID: 1)
  
è§’è‰²é€‰æ‹©:
  â— è¿æ¥ID 0: Scout

ç½‘ç»œç»Ÿè®¡
æ¸¸æˆæ˜¯å¦å·²å¯åŠ¨: false
å½“å‰é€‰æ‹©è§’è‰²: Scout
ç©å®¶æ•°é‡: 1
```

---

### ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•

ç‚¹å‡»å³ä¾§çš„ [å¯åŠ¨è‡ªåŠ¨æµ‹è¯•] æŒ‰é’®ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œï¼š

1. âœ… å¯åŠ¨ä¸»æœº
2. âœ… æ£€æŸ¥ä¸»æœºçŠ¶æ€
3. âœ… åŠ è½½è§’è‰²é€‰æ‹©åœºæ™¯
4. âœ… ä¿å­˜è§’è‰²é€‰æ‹©
5. âœ… è·å–ç©å®¶ä¿¡æ¯
6. âœ… è¾“å‡ºæµ‹è¯•ç»“æœ

---

### ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
Assets/Scripts/
â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ CustomNetworkManager.cs          â­ æ ¸å¿ƒç½‘ç»œç®¡ç†å™¨ï¼ˆå·²å¢å¼ºï¼‰
â”‚   â”œâ”€â”€ NetworkConnectionHandler.cs      â­ ç½‘ç»œäº‹ä»¶å¤„ç†ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ NetworkCharacterSelection.cs
â”‚
â”œâ”€â”€ UI/
â”‚   â”œâ”€â”€ NetworkConnectionUI.cs           â­ è¿æ¥UIï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ NetworkDebugHUD.cs               â­ è°ƒè¯•HUDï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ CharacterSelectController.cs     â­ è§’è‰²é€‰æ‹©æ§åˆ¶ï¼ˆå·²å¢å¼ºï¼‰
â”‚
â””â”€â”€ Testing/
    â””â”€â”€ NetworkIntegrationTester.cs      â­ é›†æˆæµ‹è¯•ï¼ˆæ–°å¢ï¼‰
```

---

### ğŸ”§ å…³é”®ä»£ç ç¤ºä¾‹

#### å¯åŠ¨ä¸»æœº

```csharp
CustomNetworkManager networkManager = NetworkManager.singleton as CustomNetworkManager;
networkManager.StartHost();  // åŒæ—¶å¯åŠ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
```

#### å‘é€è§’è‰²é€‰æ‹©

```csharp
CharacterSelectionMessage msg = new CharacterSelectionMessage 
{ 
    characterId = "Scout" 
};
NetworkClient.Send(msg);  // å‘é€åˆ°æœåŠ¡å™¨
```

#### æ£€æŸ¥è¿æ¥çŠ¶æ€

```csharp
bool isConnected = NetworkServer.active || NetworkClient.isConnected;
bool isServer = NetworkServer.active;
bool isClient = NetworkClient.isConnected;
```

#### è·å–ç©å®¶ä¿¡æ¯

```csharp
CustomNetworkManager mgr = NetworkManager.singleton as CustomNetworkManager;

// è·å–ç©å®¶æ•°é‡
int playerCount = mgr.GetPlayerCount();

// è·å–æ‰€æœ‰ç©å®¶çš„è§’è‰²é€‰æ‹©
Dictionary<int, string> selections = mgr.GetPlayerCharacterSelections();

// è·å–å½“å‰é€‰æ‹©çš„è§’è‰²
string selectedCharacter = mgr.GetPendingCharacterSelection();
```

---

### âš™ï¸ é…ç½®å‚æ•°

åœ¨CustomNetworkManagerçš„Inspectorä¸­å¯ä»¥é…ç½®ï¼š

| å‚æ•° | å«ä¹‰ | é»˜è®¤å€¼ |
|------|------|--------|
| GameScene | æ¸¸æˆåœºæ™¯åç§° | "GameScene" |
| CharacterSelectionScene | è§’è‰²é€‰æ‹©åœºæ™¯åç§° | "CharacterSelect" |
| MaxPlayers | æœ€å¤§ç©å®¶æ•° | 4 |
| PlayerSpawnRadius | ç©å®¶å‡ºç”ŸåŠå¾„ | 5.0 |

---

### ğŸ› å¸¸è§é—®é¢˜è§£å†³

#### Q: ç‚¹å‡»å¯åŠ¨æŒ‰é’®æ²¡æœ‰ååº”ï¼Ÿ
A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®ä¿CustomNetworkManagerå·²æ­£ç¡®é…ç½®
2. ç¡®ä¿Player Prefabå·²è®¾ç½®
3. æŸ¥çœ‹Consoleæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
4. ç¡®ä¿NetworkManager.singletonä¸ä¸ºnull

#### Q: å®¢æˆ·ç«¯æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Ÿ
A: 
1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼ˆHUDæ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€ï¼‰
2. æ£€æŸ¥ç½‘ç»œåœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆæœ¬åœ°æµ‹è¯•ç”¨"localhost"ï¼‰
3. ç¡®ä¿é˜²ç«å¢™å…è®¸è¯¥ç«¯å£é€šä¿¡
4. æŸ¥çœ‹Consoleä¸­çš„ç½‘ç»œé”™è¯¯æ—¥å¿—

#### Q: è§’è‰²é€‰æ‹©æ¶ˆæ¯æ²¡æœ‰å‘é€ï¼Ÿ
A:
1. æ£€æŸ¥isServer/isClientçš„å€¼
2. ç¡®ä¿NetworkClient.Send()æ²¡æœ‰å¼‚å¸¸
3. æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦æ”¶åˆ°OnCharacterSelectionMessage
4. æŸ¥çœ‹Consoleä¸­çš„è¯¦ç»†æ—¥å¿—

#### Q: ParrelSyncä¸­ä¸¤ä¸ªå®ä¾‹æ— æ³•é€šä¿¡ï¼Ÿ
A:
1. ç¡®ä¿ä¸€ä¸ªå®ä¾‹æ˜¯ä¸»æœºæ¨¡å¼ï¼Œå¦ä¸€ä¸ªè¿æ¥åˆ°localhost
2. æ£€æŸ¥ä¸¤ä¸ªå®ä¾‹æ˜¯å¦éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„è§’è‰²é€‰æ‹©æ¶ˆæ¯
3. ä½¿ç”¨NetworkDebugHUDéªŒè¯è¿æ¥çŠ¶æ€

---

### ğŸ“š æ›´å¤šèµ„æº

- å®Œæ•´æ–‡æ¡£ï¼š`Mirrorä¸»æœº-å®¢æˆ·ç«¯è¿æ¥åŠŸèƒ½æŒ‡å—.md`
- Mirrorå®˜æ–¹æ–‡æ¡£ï¼šhttps://mirror-networking.gitbook.io/
- é¡¹ç›®è®¾è®¡æ–‡æ¡£ï¼š`ç½‘ç»œåŒæ­¥æœºåˆ¶è®¾è®¡.md`

---

### âœ¨ æ€»ç»“

é€šè¿‡æœ¬æ¬¡å¼€å‘ï¼Œä½ å·²ç»è·å¾—ï¼š

âœ… **å®Œæ•´çš„ä¸»æœº-å®¢æˆ·ç«¯è¿æ¥æ¡†æ¶**
âœ… **çµæ´»çš„ç½‘ç»œæ¨¡å¼æ”¯æŒ**ï¼ˆä¸»æœº/æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼‰
âœ… **è‡ªåŠ¨åŒ–çš„è§’è‰²é€‰æ‹©åŒæ­¥**
âœ… **å®æ—¶ç½‘ç»œè°ƒè¯•å·¥å…·**
âœ… **é›†æˆæµ‹è¯•æ”¯æŒ**

å¯ä»¥ç«‹å³åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¿«é€Ÿæ„å»ºå¤šäººæ¸¸æˆï¼ğŸ®
